<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Rank/ELO Simulator</title>
  <style>
    body { font-family: Inter, Roboto, Arial, sans-serif; max-width:1100px; margin: 20px auto; color:#222;}
    .controls { display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-bottom:12px; }
    input, button, select { padding:6px 10px; border-radius:6px; border:1px solid #ddd; }
    .card { padding:12px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.06); background:#fff;}
    #log { height:300px; overflow:auto; border:1px solid #eee; padding:8px; white-space:pre-wrap; background:#fafafa; border-radius:6px; }
    .top-list { margin-top:10px; display:flex; flex-direction:column; gap:6px; }
    .player-row { display:flex; justify-content:space-between; padding:8px; border-radius:6px; align-items:center; }
    .player-left { display:flex; gap:8px; align-items:center; }
    .badge { padding:6px 10px; border-radius:999px; color:#fff; font-weight:700; }
    .controls .label { font-size:13px; color:#666; margin-right:6px; }
  </style>
</head>
<body>
  <h1>Rank/ELO Simulator</h1>
  <div class="card">
    <div class="controls">
      <button id="init">Init players</button>
      <label class="label">Matches <input id="matches" type="number" value="100" min="1" style="width:90px"/></label>
      <label class="label">Seed <input id="seed" type="text" placeholder="optional" style="width:90px"/></label>
      <label class="label">K <input id="k" type="number" value="32" step="0.1" style="width:80px"/></label>
      <label><input id="arcade" type="checkbox" /> Arcade</label>
      <label class="label">Streak % <input id="streak" type="number" value="0" step="0.01" style="width:80px"/></label>
      <label class="label">Decay/day <input id="decay" type="number" value="0" step="0.1" style="width:80px"/></label>
      <button id="run">Run</button>
      <button id="top">Show top</button>
    </div>

    <div style="display:flex; gap:12px;">
      <div style="flex:1">
        <h3>Top players</h3>
        <div id="top" class="top-list"></div>
      </div>
      <div style="width:420px">
        <h3>Log</h3>
        <div id="log">Ready.</div>
      </div>
    </div>
  </div>

<script>
function log(msg){ const e=document.getElementById('log'); e.textContent += '\n'+msg; e.scrollTop=e.scrollHeight; }

function renderTop(list){
  const container = document.getElementById('top');
  container.innerHTML = '';
  list.forEach((p, i) => {
    const row = document.createElement('div');
    row.className = 'player-row';
    row.style.background = 'linear-gradient(90deg, rgba(255,255,255,0.6), rgba(255,255,255,0.0))';
    const left = document.createElement('div'); left.className='player-left';
    const badge = document.createElement('div'); badge.className='badge'; badge.textContent = `${p.tier.tier} ${p.tier.division}`;
    badge.style.background = p.tier.color || '#888';
    const name = document.createElement('div'); name.textContent = `${p.name}`;
    left.appendChild(badge); left.appendChild(name);
    const right = document.createElement('div'); right.textContent = `${p.rating.toFixed(1)}`;
    row.appendChild(left); row.appendChild(right);
    container.appendChild(row);
  });
}

document.getElementById('init').onclick = async () => {
  const res = await fetch('/api/init', {method:'POST'}); const j=await res.json(); log(JSON.stringify(j)); alert(j.message || JSON.stringify(j));
};
document.getElementById('run').onclick = async () => {
  const payload = {
    matches: parseInt(document.getElementById('matches').value),
    seed: document.getElementById('seed').value,
    k: parseFloat(document.getElementById('k').value),
    arcade: document.getElementById('arcade').checked,
    streak: parseFloat(document.getElementById('streak').value),
    decay: parseFloat(document.getElementById('decay').value)
  };
  log('Starting simulation...');
  const res = await fetch('/api/run', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload)});
  const j = await res.json(); log(JSON.stringify(j)); if (j.top) renderTop(j.top);
};
document.getElementById('top').onclick = async () => {
  const res = await fetch('/api/top'); const j = await res.json(); log(JSON.stringify(j)); if (j.top) renderTop(j.top);
};
</script>
</body>
</html>
